# 重複ファイル検出・削除候補提示スクリプト 設計書

## 目的

- Linux 系 OS 上で、GB 単位の大容量ファイルを含む環境で重複ファイルを効率的に検出する。
- 重複グループを一覧化し、削除候補を明示的に提示することで、運用者が安全に整理できるようにする。

---

## 要件

- **対象**: 任意のディレクトリ配下の全ファイル
- **検出条件**:
  1. ファイルサイズが一致する
  2. 先頭 N MB の部分ハッシュが一致する
  3. 全体ハッシュが一致する
- **出力**: JSON 形式で以下を提示
  - ファイルハッシュ
  - ファイルサイズ
  - 重複グループごとのファイル一覧
  - 「残すべきファイル」と「削除候補」

---

## アルゴリズム設計

1. **ファイル収集**
   - `Path.rglob` で全ファイルを再帰的に収集。
2. **サイズグルーピング**
   - サイズが一致するファイルのみ次ステップへ。
3. **部分ハッシュ計算**
   - 先頭 N MB (`PARTIAL_READ_SIZE`) をハッシュ化し、候補を絞る。
4. **フルハッシュ計算**
   - 部分一致したグループを対象に全体ハッシュを計算。
5. **重複グループ化**
   - 完全一致したファイル群を 1 グループとしてまとめる。
6. **削除候補選定**
   - 更新日時が最新のファイルを「keep」とし、それ以外を「delete_candidates」とする。

---

## 実装

- 言語: Python 3
- 並列処理: `concurrent.futures.ProcessPoolExecutor`
- ハッシュ: `hashlib`（md5/sha256 切替可能）
- 出力: JSON (`json.dumps`)
